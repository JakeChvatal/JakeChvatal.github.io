<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Jacob Chvatal</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				font-family: Monospace;
				background-color: #f0f0f0;
				margin: 0px;
				position: absolute;
				overflow: hidden;
			}

			#title{
				position: absolute;
				width: 100%;
				text-align: center;
			}

			h1{
				text-align: center;
				font-size: 2em;
				-webkit-animation: fadein 2.2s;
				animation: fadein 2.2s;
			}

			h2{
				text-align: center;
				font-size: 1em;
				-webkit-animation: fadein 2.5s;
				animation: fadein 2.5s;
			}

			a{
				display: inline-block;
				padding-left: 20px;
				padding-right: 20px;
			}

			#footer { 
				width: 100%; 
				margin: 3em auto; 
				text-align: center; 
				position: absolute; 
				bottom: 0;
				display: inline-block;
				-webkit-animation: fadein 2.2s;
				animation: fadein 2.2s;
			}

			iframe{
				border: none;
				-webkit-animation: fadein 1.5s;
				animation: fadein 1.5s;
			}

			@keyframes fadein{
				from{opacity: 0; }
				to{opacity: 1; }
			}

		</style>
	</head>
	<body>

		<div id = "title">
			<h1>Jacob Chvatal</h1>
			<h2>designer and developer
			</h2>
		</div>

		<div id = "footer">
			<a href = "https://instagram.com/jakechvatal" target = "_blank">
				<img src = './images/icons/ig.svg' type = "image/svg+xml"></img>
			</a>
			<a href = "mailto:jakechvatal@gmail.com" target = "_blank">
				<img src = './images/icons/mail.svg' type = "image/svg+xml"></img>
			</a>
			<a href = "https://www.linkedin.com/in/jacob-chvatal-873748150" target = "_blank">
				<img src = "./images/icons/linkedin.svg" type = "image/svg+xml"></img>
			</a>
		</div>

		<script src="./build/three.js"></script>

		<script src="./modules/Projector.js"></script>
		<script src="./modules/CanvasRenderer.js"></script>
		<script src = "./modules/CSS3DRenderer.js"></script>

		<script src="./modules/tween.min.js"></script>

		<script>
			var container;
			var camera, scene, renderer;
			var rendererCSS;
			
			var raycaster;
			var mouse;
			var objects = [];
			var targets = {grid: [], align: [] };

			init();
			animate();

			function init() {

			container = document.createElement( 'div' );

				document.body.appendChild( container );

				camera = new THREE.PerspectiveCamera( 40, window.innerWidth / window.innerHeight, 1, 10000 );
				camera.position.z = 2000;

				scene = new THREE.Scene();
				scene.background = new THREE.Color( 0xf0f0f0 );

				var geometry = new THREE.BoxGeometry( 20, 20, 20 );
				
				for ( var i = 0; i < 10; i ++ ) {
					var object = new THREE.Mesh( geometry, new THREE.MeshBasicMaterial( { color: Math.random() * 0xffffff, opacity: 0.5 } ) );
					object.position.x = Math.random() * 800 - 400;
					object.position.y = Math.random() * 800 - 400;
					object.position.z = Math.random() * 800 - 400;
					object.scale.x = Math.random() * 2 + 1;
					object.scale.y = Math.random() * 2 + 1;
					object.scale.z = Math.random() * 2 + 1;
					object.rotation.x = Math.random() * 2 * Math.PI;
					object.rotation.y = Math.random() * 2 * Math.PI;
					object.rotation.z = Math.random() * 2 * Math.PI;
					
					object.userData.id = "objInfo";

					if(i==0){
						object.userData.id = "twitter"
					}

					scene.add( object );
					objects.push(object);
				}

				//grid
				for ( var i = 0; i < objects.length; i ++ ) {
					var object = new THREE.Mesh( geometry, new THREE.MeshBasicMaterial( { color: Math.random() * 0xffffff, opacity: 0.5 } ) );
					object.position.x = window.innerWidth / (objects.length) * (i % 5) - window.innerWidth/5;
					object.position.y = -Math.floor(i / 5) * window.innerHeight/5 + window.innerHeight / 10;
					object.position.z = 1000;
					
					targets.grid.push( object );
				}

				//align
				for(var i = 0; i< objects.length; i++){
					var object = new THREE.Mesh( geometry, new THREE.MeshBasicMaterial( { color: Math.random() * 0xffffff, opacity: 0.5 } ) );
					object.position.x = -window.innerWidth/2;
					object.position.y = - i * window.innerHeight / (objects.length) + window.innerHeight/2;// - window.innerHeight/(objects.length - 1);
					object.position.z = -100;

					targets.align.push( object );
				}
				
				raycaster = new THREE.Raycaster();
				mouse = new THREE.Vector2();

				renderer = new THREE.CanvasRenderer();
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );
				container.appendChild(renderer.domElement);

				cssScene = new THREE.Scene();

				rendererCSS	= new THREE.CSS3DRenderer();
				rendererCSS.setSize( window.innerWidth, window.innerHeight );
				rendererCSS.domElement.style.position = 'absolute';
				rendererCSS.domElement.style.top	  = 0;
				rendererCSS.domElement.style.margin	  = 0;
				rendererCSS.domElement.style.padding  = 0;
				container.appendChild( rendererCSS.domElement );
				
				transform(targets.grid, 1000);
				//
				document.addEventListener( 'mousedown', onMouseDown, false );
				document.addEventListener( 'touchstart', onDocumentTouchStart, false );
				window.addEventListener( 'resize', onWindowResize, false );
			}

			function transform( targets, duration, intersectObject) {
				TWEEN.removeAll();

				for ( var i = 0; i < objects.length; i ++ ) {

					var object = objects[ i ];
					var target = targets[ i ];
					
					var zOffset = 0;

					if(intersectObject && target == intersectObject){
						zOffset = 1000;
					}

					new TWEEN.Tween( object.position )
						.to( { x: target.position.x, y: target.position.y, z: target.position.z + zOffset }, Math.random() * duration + duration )
						.easing( TWEEN.Easing.Exponential.InOut )
						.start();

					new TWEEN.Tween( object.rotation )
						.to( { x: target.rotation.x, y: target.rotation.y, z: target.rotation.z }, Math.random() * duration + duration )
						.easing( TWEEN.Easing.Exponential.InOut )
						.start();
				}

				new TWEEN.Tween( this )
					.to( {}, duration * 2 )
					.onUpdate( render )
					.start();
			}

			function onWindowResize() {
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();
				renderer.setSize( window.innerWidth, window.innerHeight);
				rendererCSS.setSize(window.innerWidth, window.innerHeight);
			}
			
			function onDocumentTouchStart( event ) {
				//event.preventDefault();
				event.clientX = event.touches[0].clientX;
				event.clientY = event.touches[0].clientY;
				onMouseDown( event );
			}	

			function onMouseDown( event ) {
				//event.preventDefault();

				mouse.x = ( event.clientX / renderer.domElement.clientWidth ) * 2 - 1;
				mouse.y = - ( event.clientY / renderer.domElement.clientHeight ) * 2 + 1;

				raycaster.setFromCamera( mouse, camera );

				var intersects = raycaster.intersectObjects( scene.children );

				if ( intersects.length > 0 ) {
					clearCSSScene();
					transform(targets.align, 1000, intersects[0]);
					getDetailsPage(intersects[0].object.userData.id);
				}else{
					transform(targets.grid, 1000);
					clearCSSScene();
				}
			}

			function getDetailsPage(detail){
				var element	= document.createElement('iframe')
				element.src	= `./infoPages/${detail}.html`;

				var elementWidth = window.innerWidth * 0.8;
				var elementHeight = window.innerHeight * 1.2;
				element.style.width  = elementWidth + "px";
				element.style.height = elementHeight + "px";
				
				var cssObject = new THREE.CSS3DObject( element );
				cssScene.add(cssObject);
			}

			function clearCSSScene(){
				cssScene.children.forEach((child) =>{
					cssScene.remove(child);
				});
			}

			function animate() {
				requestAnimationFrame( animate );

				render();
				TWEEN.update();
			}

			function render() {
				camera.lookAt( scene.position );

				rendererCSS.render(cssScene, camera);
				renderer.render( scene, camera );
			}
		</script>
	</body>
</html>
